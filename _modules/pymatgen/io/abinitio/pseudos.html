<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pymatgen.io.abinitio.pseudos &mdash; pymatgen 3.1.2 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/proBlue.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '3.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="pymatgen 3.1.2 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 3.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.abinitio.pseudos</h1><div class="highlight"><pre>
<span class="c"># coding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides objects describing the basic parameters of the </span>
<span class="sd">pseudopotentials used in Abinit, and a parser to instantiate pseudopotential objects..</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">monty.string</span> <span class="kn">import</span> <span class="n">list_strings</span><span class="p">,</span> <span class="n">is_string</span>
<span class="kn">from</span> <span class="nn">monty.itertools</span> <span class="kn">import</span> <span class="n">iterator_from_slice</span>
<span class="kn">from</span> <span class="nn">monty.io</span> <span class="kn">import</span> <span class="n">FileLock</span>
<span class="kn">from</span> <span class="nn">monty.collections</span> <span class="kn">import</span> <span class="n">AttrDict</span><span class="p">,</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">monty.functools</span> <span class="kn">import</span> <span class="n">lazy_property</span>
<span class="kn">from</span> <span class="nn">monty.os.path</span> <span class="kn">import</span> <span class="n">find_exts</span>
<span class="kn">from</span> <span class="nn">monty.dev</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">pymatgen.util.plotting_utils</span> <span class="kn">import</span> <span class="n">add_fig_kwargs</span><span class="p">,</span> <span class="n">get_ax_fig_plt</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="kn">import</span> <span class="n">PeriodicTable</span><span class="p">,</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.serializers.json_coders</span> <span class="kn">import</span> <span class="n">PMGSONable</span><span class="p">,</span> <span class="n">pmg_serialize</span>
<span class="kn">from</span> <span class="nn">.eos</span> <span class="kn">import</span> <span class="n">EOS</span>
<span class="kn">from</span> <span class="nn">monty.json</span> <span class="kn">import</span> <span class="n">MontyDecoder</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;Pseudo&quot;</span><span class="p">,</span>
    <span class="s">&quot;PseudoTable&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Matteo Giantomassi&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;0.1&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">&quot;Matteo Giantomassi&quot;</span>


<span class="n">_PTABLE</span> <span class="o">=</span> <span class="n">PeriodicTable</span><span class="p">()</span>

<span class="c"># Tools and helper functions.</span>


<div class="viewcode-block" id="straceback"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.straceback">[docs]</a><span class="k">def</span> <span class="nf">straceback</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Returns a string with the traceback.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">traceback</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])))</span>

</div>
<span class="k">def</span> <span class="nf">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">nlines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read at most nlines lines from file filename.</span>
<span class="sd">    If nlines is &lt; 0, the entire file is read.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nlines</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fh</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">lineno</span> <span class="o">==</span> <span class="n">nlines</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

<span class="n">_l2str</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s">&quot;s&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;p&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">&quot;d&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">&quot;f&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s">&quot;g&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s">&quot;h&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s">&quot;i&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_str2l</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_l2str</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<div class="viewcode-block" id="l2str"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.l2str">[docs]</a><span class="k">def</span> <span class="nf">l2str</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert the angular momentum l (int) to string.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_l2str</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;Unknown angular momentum, received l = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">l</span>

</div>
<div class="viewcode-block" id="str2l"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.str2l">[docs]</a><span class="k">def</span> <span class="nf">str2l</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a string to the angular momentum l (int)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_str2l</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="Pseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo">[docs]</a><span class="k">class</span> <span class="nc">Pseudo</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="n">PMGSONable</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class defining the methods that must be </span>
<span class="sd">    implemented by the concrete pseudopotential classes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pseudo.as_pseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.as_pseudo">[docs]</a>    <span class="k">def</span> <span class="nf">as_pseudo</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert obj into a pseudo. Accepts:</span>

<span class="sd">            * Pseudo object.</span>
<span class="sd">            * string defining a valid path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span> <span class="k">else</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Pseudo.from_file"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a :class:`Pseudo` object from filename.</span>
<span class="sd">        Note: the parser knows the concrete class that should be instanciated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PseudoParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="c">#def __eq__(self, other):</span>
    <span class="c">#    if not isinstance(other, Pseudo): return False</span>
    <span class="c">#    return (self.__class__ == other.__class__ and </span>
    <span class="c">#    return (self.md5 == other.md5 and </span>
    <span class="c">#            self.text == other.text)</span>

    <span class="c">#def __ne__(self, other):</span>
    <span class="c">#    return not self.__eq__(other)</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">, name = </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>

<div class="viewcode-block" id="Pseudo.__str__"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation.&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">))</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;  summary: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;  number of valence electrons: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z_val</span><span class="p">)</span>
        <span class="c">#FIXME: rewrite the treatment of xc, use XML specs as starting point</span>
        <span class="c">#app(&quot;  XC correlation (ixc): %s&quot; % self._pspxc)  #FIXME</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;  maximum angular momentum: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">l2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">))</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;  angular momentum for local part: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">l2str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_local</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isnc</span><span class="p">:</span>
            <span class="n">app</span><span class="p">(</span><span class="s">&quot;  radius for non-linear core correction: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlcc_radius</span><span class="p">)</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_hints</span><span class="p">:</span>
            <span class="n">hint_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hint_for_accuracy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hint_normal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">app</span><span class="p">(</span><span class="s">&quot;  hint for normal accuracy: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">hint_normal</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">app</span><span class="p">(</span><span class="s">&quot;  hints on cutoff-energy are not available&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String summarizing the most important properties.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;File basename.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">Z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The atomic number of the atom.&quot;&quot;&quot;</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">Z_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Valence charge&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pymatgen :class:`Element`.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_PTABLE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_PTABLE</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Element symbol.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">l_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maximum angular momentum.&quot;&quot;&quot;</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">l_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Angular momentum used for the local part.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isnc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if norm-conserving pseudopotential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NcPseudo</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ispaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if PAW pseudopotential.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PawPseudo</span><span class="p">)</span>

    <span class="c">#@lazy_property</span>
    <span class="c">#def md5(self):</span>
    <span class="c">#    import md5</span>
    <span class="c">#    m = md5.new()</span>
    <span class="c">#    with open(self.filepath, &quot;r&quot;) as fh:</span>
    <span class="c">#        # Warning: line-based parser</span>
    <span class="c">#        for line in fh:</span>
    <span class="c">#            if line.startswith(&quot;&lt;DOJO_REPORT&gt;&quot;): break</span>
    <span class="c">#            m.update(line)</span>

    <span class="c">#    return m.digest()</span>

    <span class="c">#@lazy_property</span>
    <span class="c">#def md5(self):</span>
    <span class="c">#    &quot;&quot;&quot;Md5 hash value.&quot;&quot;&quot;</span>
    <span class="c">#    with open(self.path, &quot;r&quot;) as fh:</span>
    <span class="c">#        lines = fh.readlines()</span>
    <span class="c">#        start = lines.index(&quot;&lt;DOJO_REPORT&gt;\n&quot;)</span>
    <span class="c">#        stop = lines.index(&quot;&lt;/DOJO_REPORT&gt;\n&quot;)</span>
    <span class="c">#        text = &quot;&quot;.join(lines[:start])</span>
    <span class="c">#    </span>
    <span class="c">#        import hashlib</span>
    <span class="c">#        return hashlib.md5(text)</span>

    <span class="c">#@abc.abstractproperty</span>
    <span class="c">#def xc_type(self):</span>
    <span class="c">#    &quot;&quot;&quot;XC family e.g LDA, GGA, MGGA.&quot;&quot;&quot;</span>

    <span class="c">#@abc.abstractproperty</span>
    <span class="c">#def xc_flavor(self):</span>
    <span class="c">#    &quot;&quot;&quot;XC flavor e.g PW, PW91, PBE.&quot;&quot;&quot;</span>

    <span class="c">#@property</span>
    <span class="c">#def xc_functional(self):</span>
    <span class="c">#    &quot;&quot;&quot;XC identifier e.g LDA-PW91, GGA-PBE, GGA-revPBE.&quot;&quot;&quot;</span>
    <span class="c">#    return &quot;-&quot;.join([self.xc_type, self.xc_flavor])</span>

    <span class="c">#@abc.abstractproperty</span>
    <span class="c">#def has_soc(self):</span>
    <span class="c">#    &quot;&quot;&quot;True if pseudo contains spin-orbit coupling.&quot;&quot;&quot;</span>

    <span class="c">#@abc.abstractmethod</span>
    <span class="c">#def num_of_projectors(self, l=&#39;s&#39;):</span>
    <span class="c">#    &quot;&quot;&quot;Number of projectors for the angular channel l&quot;&quot;&quot;</span>

    <span class="c">#@abc.abstractmethod</span>
    <span class="c">#def generation_mode</span>
    <span class="c">#    &quot;&quot;&quot;scalar scalar-relativistic, relativistic.&quot;&quot;&quot;</span>

    <span class="nd">@pmg_serialize</span>
<div class="viewcode-block" id="Pseudo.as_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">basename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
            <span class="n">symbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
            <span class="n">Z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
            <span class="n">Z_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Z_val</span><span class="p">,</span>
            <span class="n">l_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l_max</span><span class="p">,</span>
            <span class="c">#md5=self.md5,</span>
            <span class="c">#nlcc_radius=self.nlcc_radius,</span>
            <span class="c">#xc_type=</span>
            <span class="c">#pp_type=</span>
            <span class="n">filepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span>
        <span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Pseudo.from_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;filepath&#39;</span><span class="p">])</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_dojo_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if self contains the `DOJO_REPORT` section.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span><span class="p">)</span>

<div class="viewcode-block" id="Pseudo.delta_factor"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.delta_factor">[docs]</a>    <span class="k">def</span> <span class="nf">delta_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the deltafactor [meV/natom] computed with the given accuracy.</span>
<span class="sd">        None if the `Pseudo` does not have info on the deltafactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_dojo_report</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span><span class="p">[</span><span class="s">&quot;delta_factor&quot;</span><span class="p">][</span><span class="n">accuracy</span><span class="p">][</span><span class="s">&quot;dfact&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Pseudo.read_dojo_report"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.read_dojo_report">[docs]</a>    <span class="k">def</span> <span class="nf">read_dojo_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the `DOJO_REPORT` section and set dojo_report attribute.</span>
<span class="sd">        returns {} if section is not present.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span>
</div>
<div class="viewcode-block" id="Pseudo.write_dojo_report"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.write_dojo_report">[docs]</a>    <span class="k">def</span> <span class="nf">write_dojo_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write a new `DOJO_REPORT` section to the pseudopotential file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">report</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span>

        <span class="n">report</span><span class="p">[</span><span class="s">&quot;symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span>

        <span class="c"># Create JSON string from report.</span>
        <span class="n">jstring</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Read lines from file and insert jstring between the tags.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c"># DOJO_REPORT was not present.</span>
                <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&quot;&lt;DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">jstring</span> <span class="p">,</span> <span class="s">&quot;&lt;/DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;/DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">jstring</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>

        <span class="c">#  Write new file.</span>
        <span class="k">with</span> <span class="n">FileLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Pseudo.remove_dojo_report"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.remove_dojo_report">[docs]</a>    <span class="k">def</span> <span class="nf">remove_dojo_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the `DOJO_REPORT` section from the pseudopotential file.&quot;&quot;&quot;</span>
        <span class="c"># Read lines from file and insert jstring between the tags.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span>

            <span class="n">stop</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;/DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span>

            <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>

        <span class="c"># Write new file.</span>
        <span class="k">with</span> <span class="n">FileLock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Pseudo.hint_for_accuracy"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Pseudo.hint_for_accuracy">[docs]</a>    <span class="k">def</span> <span class="nf">hint_for_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an hint object with parameters such as ecut [Ha] and </span>
<span class="sd">        aug_ratio for given accuracy. Returns None if no hint is available.</span>

<span class="sd">        Args:</span>
<span class="sd">            accuracy: [&quot;low&quot;, &quot;normal&quot;, &quot;high&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_dojo_report</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Hint</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span><span class="p">[</span><span class="s">&quot;hints&quot;</span><span class="p">][</span><span class="n">accuracy</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if self provides hints on the cutoff energy.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;low&quot;</span><span class="p">,</span> <span class="s">&quot;normal&quot;</span><span class="p">,</span> <span class="s">&quot;high&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hint_for_accuracy</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="NcPseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcPseudo">[docs]</a><span class="k">class</span> <span class="nc">NcPseudo</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class defining the methods that must be implemented</span>
<span class="sd">    by the concrete classes representing norm-conserving pseudopotentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">nlcc_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Radius at which the core charge vanish (i.e. cut-off in a.u.).</span>
<span class="sd">        Returns 0.0 if nlcc is not used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_nlcc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if the pseudo is generated with non-linear core correction.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlcc_radius</span> <span class="o">&gt;</span> <span class="mf">0.0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rcore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Radius of the pseudization sphere in a.u.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_core</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="PawPseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawPseudo">[docs]</a><span class="k">class</span> <span class="nc">PawPseudo</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class that defines the methods that must be implemented</span>
<span class="sd">    by the concrete classes representing PAW pseudopotentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#def nlcc_radius(self):</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    Radius at which the core charge vanish (i.e. cut-off in a.u.).</span>
    <span class="c">#    Returns 0.0 if nlcc is not used.</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    return 0.0</span>
    <span class="c">#                                                                           </span>

    <span class="c">#@property</span>
    <span class="c">#def has_nlcc(self):</span>
    <span class="c">#    &quot;&quot;&quot;True if the pseudo is generated with non-linear core correction.&quot;&quot;&quot;</span>
    <span class="c">#    return True</span>

    <span class="nd">@abc.abstractproperty</span>
    <span class="k">def</span> <span class="nf">paw_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Radius of the PAW sphere in a.u.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rcore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alias of paw_radius.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paw_radius</span>

</div>
<div class="viewcode-block" id="AbinitPseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.AbinitPseudo">[docs]</a><span class="k">class</span> <span class="nc">AbinitPseudo</span><span class="p">(</span><span class="n">Pseudo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An AbinitPseudo is a pseudopotential whose file contains an abinit header.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            path: Filename.</span>
<span class="sd">            header: :class:`AbinitHeader` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">summary</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s">&quot;dojo_report&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">dojo_report</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c">#self.pspcod  = header.pspcod</span>

        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="c"># Hide these attributes since one should always use the public interface.</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Summary line reported in the ABINIT header.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zatom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zion</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lmax</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lloc</span>

</div>
<div class="viewcode-block" id="NcAbinitPseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitPseudo">[docs]</a><span class="k">class</span> <span class="nc">NcAbinitPseudo</span><span class="p">(</span><span class="n">NcPseudo</span><span class="p">,</span> <span class="n">AbinitPseudo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Norm-conserving pseudopotential in the Abinit format.&quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zatom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of valence electrons.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zion</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lmax</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lloc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nlcc_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rchrg</span>

</div>
<div class="viewcode-block" id="PawAbinitPseudo"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawAbinitPseudo">[docs]</a><span class="k">class</span> <span class="nc">PawAbinitPseudo</span><span class="p">(</span><span class="n">PawPseudo</span><span class="p">,</span> <span class="n">AbinitPseudo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Paw pseudopotential in the Abinit format.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paw_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r_cut</span>

    <span class="c">#def orbitals(self):</span>

</div>
<div class="viewcode-block" id="Hint"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Hint">[docs]</a><span class="k">class</span> <span class="nc">Hint</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;Hint&quot;</span><span class="p">,</span> <span class="s">&quot;ecut aug_ratio&quot;</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Suggested value for the cutoff energy [Hartree units] and the augmentation ratio (PAW pseudo)</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Hint.as_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Hint.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">}</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Hint.from_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.Hint.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)})</span>

</div></div>
<span class="k">def</span> <span class="nf">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">key_nums</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to parse formatted text structured like:</span>

<span class="sd">    value1 value2 ... sep key1, key2 ...</span>

<span class="sd">    key_nums is a list giving the number of keys for each line. 0 if line should be skipped.</span>
<span class="sd">    sep is a string denoting the character that separates the keys from the value (None if</span>
<span class="sd">    no separator is present).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict{key1 : value1, key2 : value2, ...}</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError if parsing fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_nums</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
        <span class="n">key_nums</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key_nums</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_nums</span><span class="p">):</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="s">&quot;lines = </span><span class="si">%s</span><span class="se">\n</span><span class="s"> key_num =  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_nums</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nk</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">key_nums</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="n">nk</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">nk</span><span class="p">:])</span>
        <span class="c"># Sanitize keys: In some case we might string in for  foo[,bar]</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;[&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;]&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">check</span> <span class="o">!=</span> <span class="n">sep</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Expecting separator </span><span class="si">%s</span><span class="s">, got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">check</span><span class="p">))</span>
            <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;line: </span><span class="si">%s</span><span class="se">\n</span><span class="s"> len(keys) != len(value)</span><span class="se">\n</span><span class="s">keys: </span><span class="si">%s</span><span class="se">\n</span><span class="s"> values:  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">kwargs</span>


<div class="viewcode-block" id="AbinitHeader"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.AbinitHeader">[docs]</a><span class="k">class</span> <span class="nc">AbinitHeader</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dictionary whose keys can be also accessed as attributes.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Default behaviour</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AbinitHeader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Try in the dictionary.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>

</div>
<span class="k">def</span> <span class="nf">_int_from_str</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert string into integer</span>

<span class="sd">    Raise:</span>
<span class="sd">        TypeError if string is not a valid integer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">float_num</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="n">int_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">float_num</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">float_num</span> <span class="o">==</span> <span class="n">int_num</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">int_num</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Cannot convert string </span><span class="si">%s</span><span class="s"> to int&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>


<div class="viewcode-block" id="NcAbinitHeader"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader">[docs]</a><span class="k">class</span> <span class="nc">NcAbinitHeader</span><span class="p">(</span><span class="n">AbinitHeader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The abinit header found in the NC pseudopotential files.&quot;&quot;&quot;</span>
    <span class="n">_attr_desc</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;att&quot;</span><span class="p">,</span> <span class="s">&quot;default astype&quot;</span><span class="p">)</span>

    <span class="n">_VARS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c"># Mandatory</span>
        <span class="s">&quot;zatom&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">_int_from_str</span><span class="p">),</span>
        <span class="s">&quot;zion&quot;</span>         <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;pspdat&quot;</span>       <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;pspcod&quot;</span>       <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;pspxc&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;lmax&quot;</span>         <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;lloc&quot;</span>         <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;r2well&quot;</span>       <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;mmax&quot;</span>         <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="c"># Optional variables for non linear-core correction. HGH does not have it.</span>
        <span class="s">&quot;rchrg&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="nb">float</span><span class="p">),</span>  <span class="c"># radius at which the core charge vanish (i.e. cut-off in a.u.)</span>
        <span class="s">&quot;fchrg&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;qchrg&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span>  <span class="nb">float</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">del</span> <span class="n">_attr_desc</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NcAbinitHeader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="c"># APE uses llocal instead of lloc.</span>
        <span class="k">if</span> <span class="s">&quot;llocal&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;lloc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;llocal&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">_VARS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">default</span><span class="p">,</span> <span class="n">astype</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">astype</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Attribute </span><span class="si">%s</span><span class="s"> must be specified&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">astype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Conversion Error for key </span><span class="si">%s</span><span class="s">, value </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c"># Add dojo_report</span>
        <span class="bp">self</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;dojo_report&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c">#if kwargs:</span>
        <span class="c">#    raise RuntimeError(&quot;kwargs should be empty but got %s&quot; % str(kwargs))</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NcAbinitHeader.fhi_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader.fhi_header">[docs]</a>    <span class="k">def</span> <span class="nf">fhi_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the FHI abinit header.&quot;&quot;&quot;</span>
        <span class="c"># Example:</span>
        <span class="c"># Troullier-Martins psp for element  Sc        Thu Oct 27 17:33:22 EDT 1994</span>
        <span class="c">#  21.00000   3.00000    940714                zatom, zion, pspdat</span>
        <span class="c">#    1    1    2    0      2001    .00000      pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c"># 1.80626423934776     .22824404341771    1.17378968127746   rchrg,fchrg,qchrg</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c"># The last record with rchrg ... seems to be optional.</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NcAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NcAbinitHeader.hgh_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader.hgh_header">[docs]</a>    <span class="k">def</span> <span class="nf">hgh_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the HGH abinit header.&quot;&quot;&quot;</span>
        <span class="c"># Example:</span>
        <span class="c">#Hartwigsen-Goedecker-Hutter psp for Ne,  from PRB58, 3641 (1998)</span>
        <span class="c">#   10   8  010605 zatom,zion,pspdat</span>
        <span class="c"># 3 1   1 0 2001 0  pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NcAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NcAbinitHeader.gth_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader.gth_header">[docs]</a>    <span class="k">def</span> <span class="nf">gth_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the GTH abinit header.&quot;&quot;&quot;</span>
        <span class="c"># Example:</span>
        <span class="c">#Goedecker-Teter-Hutter  Wed May  8 14:27:44 EDT 1996</span>
        <span class="c">#1   1   960508                     zatom,zion,pspdat</span>
        <span class="c">#2   1   0    0    2001    0.       pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c">#0.2000000 -4.0663326  0.6778322 0 0     rloc, c1, c2, c3, c4</span>
        <span class="c">#0 0 0                              rs, h1s, h2s</span>
        <span class="c">#0 0                                rp, h1p</span>
        <span class="c">#  1.36 .2   0.6                    rcutoff, rloc</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NcAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NcAbinitHeader.oncvpsp_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader.oncvpsp_header">[docs]</a>    <span class="k">def</span> <span class="nf">oncvpsp_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the ONCVPSP abinit header.&quot;&quot;&quot;</span>
        <span class="c"># Example</span>
        <span class="c">#Li    ONCVPSP  r_core=  2.01  3.02</span>
        <span class="c">#      3.0000      3.0000      140504    zatom,zion,pspd</span>
        <span class="c">#     8     2     1     4   600     0    pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c">#  5.99000000  0.00000000  0.00000000    rchrg fchrg qchrg</span>
        <span class="c">#     2     2     0     0     0    nproj</span>
        <span class="c">#     0                 extension_switch</span>
        <span class="c">#   0                        -2.5000025868368D+00 -1.2006906995331D+00</span>
        <span class="c">#     1  0.0000000000000D+00  0.0000000000000D+00  0.0000000000000D+00</span>
        <span class="c">#     2  1.0000000000000D-02  4.4140499497377D-02  1.9909081701712D-02</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;pspdat&#39;</span><span class="p">:</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;pspd&#39;</span><span class="p">]})</span>
        <span class="n">header</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;pspd&#39;</span><span class="p">)</span>

        <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NcAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="NcAbinitHeader.tm_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.NcAbinitHeader.tm_header">[docs]</a>    <span class="k">def</span> <span class="nf">tm_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the TM abinit header.&quot;&quot;&quot;</span>
        <span class="c"># Example:</span>
        <span class="c">#Troullier-Martins psp for element Fm         Thu Oct 27 17:28:39 EDT 1994</span>
        <span class="c">#100.00000  14.00000    940714                zatom, zion, pspdat</span>
        <span class="c">#   1    1    3    0      2001    .00000      pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c">#   0   4.085   6.246    0   2.8786493        l,e99.0,e99.9,nproj,rcpsp</span>
        <span class="c">#   .00000000    .0000000000    .0000000000    .00000000   rms,ekb1,ekb2,epsatm</span>
        <span class="c">#   1   3.116   4.632    1   3.4291849        l,e99.0,e99.9,nproj,rcpsp</span>
        <span class="c">#   .00000000    .0000000000    .0000000000    .00000000   rms,ekb1,ekb2,epsatm</span>
        <span class="c">#   2   4.557   6.308    1   2.1865358        l,e99.0,e99.9,nproj,rcpsp</span>
        <span class="c">#   .00000000    .0000000000    .0000000000    .00000000   rms,ekb1,ekb2,epsatm</span>
        <span class="c">#   3  23.251  29.387    1   2.4776730        l,e99.0,e99.9,nproj,rcpsp</span>
        <span class="c">#   .00000000    .0000000000    .0000000000    .00000000   rms,ekb1,ekb2,epsatm</span>
        <span class="c">#   3.62474762267880     .07409391739104    3.07937699839200   rchrg,fchrg,qchrg</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lineno</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
                <span class="c"># Read lmax.</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">pspcod</span><span class="p">,</span> <span class="n">pspxc</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lloc</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">mmax</span><span class="p">,</span> <span class="n">r2well</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                <span class="c">#if tokens[-1].strip() != &quot;pspcod,pspxc,lmax,lloc,mmax,r2well&quot;:</span>
                <span class="c">#    raise RuntimeError(&quot;%s: Invalid line\n %s&quot;  % (filename, line))</span>

                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
                <span class="k">break</span>

        <span class="c"># TODO</span>
        <span class="c"># Parse the section with the projectors.</span>
        <span class="c">#0   4.085   6.246    0   2.8786493        l,e99.0,e99.9,nproj,rcpsp</span>
        <span class="c">#.00000000    .0000000000    .0000000000    .00000000   rms,ekb1,ekb2,epsatm</span>
        <span class="n">projectors</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">proj_info</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">,]</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">proj_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">proj_info</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">projectors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;l&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">d</span>

        <span class="c"># Add the last line with info on nlcc.</span>
        <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NcAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PawAbinitHeader"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawAbinitHeader">[docs]</a><span class="k">class</span> <span class="nc">PawAbinitHeader</span><span class="p">(</span><span class="n">AbinitHeader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The abinit header found in the PAW pseudopotential files.&quot;&quot;&quot;</span>
    <span class="n">_attr_desc</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;att&quot;</span><span class="p">,</span> <span class="s">&quot;default astype&quot;</span><span class="p">)</span>

    <span class="n">_VARS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;zatom&quot;</span>           <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">_int_from_str</span><span class="p">),</span>
        <span class="s">&quot;zion&quot;</span>            <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;pspdat&quot;</span>          <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;pspcod&quot;</span>          <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;pspxc&quot;</span>           <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;lmax&quot;</span>            <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;lloc&quot;</span>            <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;mmax&quot;</span>            <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;r2well&quot;</span>          <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="s">&quot;pspfmt&quot;</span>          <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="s">&quot;creatorID&quot;</span>       <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;basis_size&quot;</span>      <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;lmn_size&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;orbitals&quot;</span>        <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>
        <span class="s">&quot;number_of_meshes&quot;</span><span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;r_cut&quot;</span>           <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="c"># r_cut(PAW) in the header</span>
        <span class="s">&quot;shape_type&quot;</span>      <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s">&quot;rshape&quot;</span>          <span class="p">:</span> <span class="n">_attr_desc</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">del</span> <span class="n">_attr_desc</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PawAbinitHeader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VARS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">default</span><span class="p">,</span> <span class="n">astype</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">desc</span><span class="o">.</span><span class="n">astype</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">default</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Attribute </span><span class="si">%s</span><span class="s"> must be specified&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">astype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Conversion Error for key </span><span class="si">%s</span><span class="s">, with value </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;kwargs should be empty but got </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PawAbinitHeader.paw_header"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawAbinitHeader.paw_header">[docs]</a>    <span class="k">def</span> <span class="nf">paw_header</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the PAW abinit header.&quot;&quot;&quot;</span>
        <span class="c">#Paw atomic data for element Ni - Generated by AtomPAW (N. Holzwarth) + AtomPAW2Abinit v3.0.5</span>
        <span class="c">#  28.000  18.000 20061204               : zatom,zion,pspdat</span>
        <span class="c">#  7  7  2 0   350 0.                    : pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c"># paw3 1305                              : pspfmt,creatorID</span>
        <span class="c">#  5 13                                  : basis_size,lmn_size</span>
        <span class="c"># 0 0 1 1 2                              : orbitals</span>
        <span class="c"># 3                                      : number_of_meshes</span>
        <span class="c"># 1 3  350 1.1803778368E-05 3.5000000000E-02 : mesh 1, type,size,rad_step[,log_step]</span>
        <span class="c"># 2 1  921 2.500000000000E-03                : mesh 2, type,size,rad_step[,log_step]</span>
        <span class="c"># 3 3  391 1.1803778368E-05 3.5000000000E-02 : mesh 3, type,size,rad_step[,log_step]</span>
        <span class="c">#  2.3000000000                          : r_cut(SPH)</span>
        <span class="c"># 2 0.                </span>

        <span class="c"># Example</span>
        <span class="c">#C  (US d-loc) - PAW data extracted from US-psp (D.Vanderbilt) - generated by USpp2Abinit v2.3.0</span>
        <span class="c">#   6.000   4.000 20090106               : zatom,zion,pspdat</span>
        <span class="c">#  7 11  1 0   560 0.                    : pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c"># paw4 2230                              : pspfmt,creatorID</span>
        <span class="c">#  4  8                                  : basis_size,lmn_size</span>
        <span class="c"># 0 0 1 1                                : orbitals</span>
        <span class="c"># 5                                      : number_of_meshes</span>
        <span class="c"># 1 2  560 1.5198032759E-04 1.6666666667E-02 : mesh 1, type,size,rad_step[,log_step]</span>
        <span class="c"># 2 2  556 1.5198032759E-04 1.6666666667E-02 : mesh 2, type,size,rad_step[,log_step]</span>
        <span class="c"># 3 2  576 1.5198032759E-04 1.6666666667E-02 : mesh 3, type,size,rad_step[,log_step]</span>
        <span class="c"># 4 2  666 1.5198032759E-04 1.6666666667E-02 : mesh 4, type,size,rad_step[,log_step]</span>
        <span class="c"># 5 2  673 1.5198032759E-04 1.6666666667E-02 : mesh 5, type,size,rad_step[,log_step]</span>
        <span class="c">#  1.5550009124                          : r_cut(PAW)</span>
        <span class="c"># 3 0.                                   : shape_type,rshape</span>

        <span class="c">#Paw atomic data for element Si - Generated by atompaw v3.0.1.3 &amp; AtomPAW2Abinit v3.3.1</span>
        <span class="c">#  14.000   4.000 20120814               : zatom,zion,pspdat</span>
        <span class="c">#  7      11  1 0   663 0.               : pspcod,pspxc,lmax,lloc,mmax,r2well</span>
        <span class="c"># paw5 1331                              : pspfmt,creatorID</span>
        <span class="c">#  4  8                                  : basis_size,lmn_size</span>
        <span class="c"># 0 0 1 1                                : orbitals</span>
        <span class="c"># 5                                      : number_of_meshes</span>
        <span class="c"># 1 2  663 8.2129718540404674E-04 1.1498160595656655E-02 : mesh 1, type,size,rad_step[,log_step]</span>
        <span class="c"># 2 2  658 8.2129718540404674E-04 1.1498160595656655E-02 : mesh 2, type,size,rad_step[,log_step]</span>
        <span class="c"># 3 2  740 8.2129718540404674E-04 1.1498160595656655E-02 : mesh 3, type,size,rad_step[,log_step]</span>
        <span class="c"># 4 2  819 8.2129718540404674E-04 1.1498160595656655E-02 : mesh 4, type,size,rad_step[,log_step]</span>
        <span class="c"># 5 2  870 8.2129718540404674E-04 1.1498160595656655E-02 : mesh 5, type,size,rad_step[,log_step]</span>
        <span class="c">#  1.5669671236                          : r_cut(PAW)</span>
        <span class="c"># 2 0.                                   : shape_type,rshape</span>
        <span class="n">supported_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;paw3&quot;</span><span class="p">,</span> <span class="s">&quot;paw4&quot;</span><span class="p">,</span> <span class="s">&quot;paw5&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ppdesc</span><span class="o">.</span><span class="n">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_formats</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;format </span><span class="si">%s</span><span class="s"> not in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ppdesc</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">supported_formats</span><span class="p">))</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
        <span class="c"># TODO</span>
        <span class="c"># Parse orbitals and number of meshes.</span>
        <span class="n">header</span><span class="p">[</span><span class="s">&quot;orbitals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">header</span><span class="p">[</span><span class="s">&quot;number_of_meshes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_meshes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#print filename, header</span>

        <span class="c"># Skip meshes =</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="o">+</span><span class="n">num_meshes</span><span class="p">:]</span>
        <span class="c">#for midx in range(num_meshes):</span>
        <span class="c">#    l = midx + 1</span>

        <span class="c">#print lines[0]</span>
        <span class="n">header</span><span class="p">[</span><span class="s">&quot;r_cut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#print lines[1]</span>
        <span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict_from_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;:&quot;</span><span class="p">))</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">DojoReport</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s">&quot;dojo_report&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">report</span>

        <span class="c">#print(&quot;PAW header\n&quot;, header)</span>
        <span class="k">return</span> <span class="n">PawAbinitHeader</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="o">**</span><span class="n">header</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PseudoParserError"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoParserError">[docs]</a><span class="k">class</span> <span class="nc">PseudoParserError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base Error class for the exceptions raised by :class:`PseudoParser`&quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="PseudoParser"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoParser">[docs]</a><span class="k">class</span> <span class="nc">PseudoParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Responsible for parsing pseudopotential files and returning pseudopotential objects.</span>

<span class="sd">    Usage::</span>

<span class="sd">        pseudo = PseudoParser().parse(&quot;filename&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Error</span> <span class="o">=</span> <span class="n">PseudoParserError</span>

    <span class="c"># Supported values of pspcod</span>
    <span class="n">ppdesc</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;ppdesc&quot;</span><span class="p">,</span> <span class="s">&quot;pspcod name psp_type format&quot;</span><span class="p">)</span>

    <span class="c"># TODO Recheck</span>
    <span class="n">_PSPCODES</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;TM&quot;</span><span class="p">,</span>  <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="mi">2</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;GTH&quot;</span><span class="p">,</span>  <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="mi">3</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;HGH&quot;</span><span class="p">,</span> <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="c">#4: ppdesc(4, &quot;NC&quot;,     , None),</span>
        <span class="c">#5: ppdesc(5, &quot;NC&quot;,     , None),</span>
        <span class="mi">6</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s">&quot;FHI&quot;</span><span class="p">,</span> <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="mi">7</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s">&quot;PAW_abinit_text&quot;</span><span class="p">,</span> <span class="s">&quot;PAW&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
        <span class="mi">8</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">&quot;ONCVPSP&quot;</span><span class="p">,</span> <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
       <span class="mi">10</span><span class="p">:</span> <span class="n">ppdesc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s">&quot;HGHK&quot;</span><span class="p">,</span> <span class="s">&quot;NC&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">})</span>
    <span class="k">del</span> <span class="n">ppdesc</span>
    <span class="c"># renumber functionals from oncvpsp todo confrim that 3 is 2</span>
    <span class="n">_FUNCTIONALS</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Wigner&#39;</span><span class="p">},</span>
                    <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;HL&#39;</span><span class="p">},</span>
                    <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;PWCA&#39;</span><span class="p">},</span>
                    <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;PBE&#39;</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># List of files that have been parsed succesfully.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># List of files that could not been parsed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrong_paths</span>  <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="PseudoParser.scan_directory"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoParser.scan_directory">[docs]</a>    <span class="k">def</span> <span class="nf">scan_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">exclude_exts</span><span class="o">=</span><span class="p">(),</span> <span class="n">exclude_fnames</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze the files contained in directory dirname.</span>

<span class="sd">        Args:</span>
<span class="sd">            dirname: directory path</span>
<span class="sd">            exclude_exts: list of file extensions that should be skipped.</span>
<span class="sd">            exclude_fnames: list of file names that should be skipped.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of pseudopotential objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exclude_exts</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">):</span>
                <span class="n">exclude_exts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">ext</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># Exclude files depending on the extension.</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
            <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ext</span> <span class="ow">in</span> <span class="n">exclude_exts</span> <span class="ow">or</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">exclude_fnames</span> <span class="ow">or</span> 
                <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span> <span class="k">continue</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="c"># Parse the file and generate the pseudo.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pseudo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pseudo</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="n">pseudo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">pseudos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pseudo</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrong_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pseudos</span>
</div>
<div class="viewcode-block" id="PseudoParser.read_ppdesc"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoParser.read_ppdesc">[docs]</a>    <span class="k">def</span> <span class="nf">read_ppdesc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the pseudopotential descriptor from file filename.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pseudopotential descriptor. None if filename is not a valid pseudopotential file.</span>

<span class="sd">        Raises:</span>
<span class="sd">            `PseudoParserError` if fileformat is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.xml&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;XML pseudo not supported yet&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Assume file with the abinit header.</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">_read_nlines</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">lineno</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">pspcod</span><span class="p">,</span> <span class="n">pspxc</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: Cannot parse pspcod, pspxc in line</span><span class="se">\n</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">None</span>

                    <span class="c">#if tokens[-1].strip().replace(&quot; &quot;,&quot;&quot;) not in [&quot;pspcod,pspxc,lmax,lloc,mmax,r2well&quot;,</span>
                    <span class="c">#                              &quot;pspcod,pspxc,lmax,llocal,mmax,r2well&quot;]:</span>
                    <span class="c">#    raise self.Error(&quot;%s: Invalid line\n %s&quot;  % (filename, line))</span>
                    <span class="c">#    return None</span>

                    <span class="k">if</span> <span class="n">pspcod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PSPCODES</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: Don&#39;t know how to handle pspcod </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pspcod</span><span class="p">))</span>

                    <span class="n">ppdesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PSPCODES</span><span class="p">[</span><span class="n">pspcod</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">pspcod</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                        <span class="c"># PAW -&gt; need to know the format pspfmt</span>
                        <span class="n">tokens</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">lineno</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">pspfmt</span><span class="p">,</span> <span class="n">creatorID</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c">#if tokens[-1].strip() != &quot;pspfmt,creatorID&quot;:</span>
                        <span class="c">#    raise self.Error(&quot;%s: Invalid line\n %s&quot; % (filename, line))</span>
                        <span class="c">#    return None</span>

                        <span class="n">ppdesc</span> <span class="o">=</span> <span class="n">ppdesc</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">format</span> <span class="o">=</span> <span class="n">pspfmt</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">ppdesc</span>

            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="PseudoParser.parse"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read and parse a pseudopotential file. Main entry point for client code.</span>

<span class="sd">        Returns: </span>
<span class="sd">            pseudopotential object or None if filename is not a valid pseudopotential file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c"># Only PAW supports XML at present.</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.xml&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">PawXmlSetup</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">ppdesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ppdesc</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ppdesc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">psp_type</span> <span class="o">=</span> <span class="n">ppdesc</span><span class="o">.</span><span class="n">psp_type</span>

        <span class="n">parsers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;FHI&quot;</span>            <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">fhi_header</span><span class="p">,</span>
            <span class="s">&quot;GTH&quot;</span>            <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">gth_header</span><span class="p">,</span>
            <span class="s">&quot;TM&quot;</span>             <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">tm_header</span><span class="p">,</span>
            <span class="s">&quot;HGH&quot;</span>            <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">hgh_header</span><span class="p">,</span>
            <span class="s">&quot;HGHK&quot;</span>           <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">hgh_header</span><span class="p">,</span>
            <span class="s">&quot;ONCVPSP&quot;</span>        <span class="p">:</span> <span class="n">NcAbinitHeader</span><span class="o">.</span><span class="n">oncvpsp_header</span><span class="p">,</span>
            <span class="s">&quot;PAW_abinit_text&quot;</span><span class="p">:</span> <span class="n">PawAbinitHeader</span><span class="o">.</span><span class="n">paw_header</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">parsers</span><span class="p">[</span><span class="n">ppdesc</span><span class="o">.</span><span class="n">name</span><span class="p">](</span><span class="n">path</span><span class="p">,</span> <span class="n">ppdesc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">straceback</span><span class="p">())</span>

        <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">psp_type</span> <span class="o">==</span> <span class="s">&quot;NC&quot;</span><span class="p">:</span>
            <span class="n">pseudo</span> <span class="o">=</span> <span class="n">NcAbinitPseudo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psp_type</span> <span class="o">==</span> <span class="s">&quot;PAW&quot;</span><span class="p">:</span>
            <span class="n">pseudo</span> <span class="o">=</span> <span class="n">PawAbinitPseudo</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;psp_type not in [NC, PAW]&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pseudo</span>


<span class="c">#TODO use RadialFunction from pseudo_dojo.</span></div></div>
<div class="viewcode-block" id="RadialFunction"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.RadialFunction">[docs]</a><span class="k">class</span> <span class="nc">RadialFunction</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;RadialFunction&quot;</span><span class="p">,</span> <span class="s">&quot;mesh values&quot;</span><span class="p">)):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="PawXmlSetup"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawXmlSetup">[docs]</a><span class="k">class</span> <span class="nc">PawXmlSetup</span><span class="p">(</span><span class="n">Pseudo</span><span class="p">,</span> <span class="n">PawPseudo</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="c"># FIXME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dojo_report</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c"># Get the XML root (this trick is used to that the object is pickleable).</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

        <span class="c"># Get the version of the XML format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paw_setup_version</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">)</span>

        <span class="c"># Info on the atom.</span>
        <span class="n">atom_attrib</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;atom&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>

        <span class="c">#self._symbol = atom_attrib[&quot;symbol&quot;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zatom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">atom_attrib</span><span class="p">[</span><span class="s">&quot;Z&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="p">[</span><span class="n">atom_attrib</span><span class="p">[</span><span class="s">&quot;core&quot;</span><span class="p">],</span> <span class="n">atom_attrib</span><span class="p">[</span><span class="s">&quot;valence&quot;</span><span class="p">]])</span>

        <span class="c">#xc_info = root.find(&quot;atom&quot;).attrib</span>
        <span class="c">#self.xc_type, self.xc_name  = xc_info[&quot;type&quot;], xc_info[&quot;name&quot;]</span>
        <span class="c">#self.ae_energy = {k: float(v) for k,v in root.find(&quot;ae_energy&quot;).attrib.items()}</span>

        <span class="c"># Old XML files do not define this field!</span>
        <span class="c"># In this case we set the PAW radius to None.</span>
        <span class="c">#self._paw_radius = float(root.find(&quot;PAW_radius&quot;).attrib[&quot;rpaw&quot;])</span>

        <span class="n">pawr_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;PAW_radius&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paw_radius</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">pawr_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paw_radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pawr_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&quot;rpaw&quot;</span><span class="p">])</span>

        <span class="c">#&lt;valence_states&gt;</span>
        <span class="c">#  &lt;state n=&quot;2&quot; l=&quot;0&quot; f=&quot;2&quot;  rc=&quot;1.10&quot; e=&quot;-0.6766&quot; id=&quot;N-2s&quot;/&gt;</span>
        <span class="c">#  &lt;state n=&quot;2&quot; l=&quot;1&quot; f=&quot;3&quot;  rc=&quot;1.10&quot; e=&quot;-0.2660&quot; id=&quot;N-2p&quot;/&gt;</span>
        <span class="c">#  &lt;state       l=&quot;0&quot;        rc=&quot;1.10&quot; e=&quot; 0.3234&quot; id=&quot;N-s1&quot;/&gt;</span>
        <span class="c">#  &lt;state       l=&quot;1&quot;        rc=&quot;1.10&quot; e=&quot; 0.7340&quot; id=&quot;N-p1&quot;/&gt;</span>
        <span class="c">#  &lt;state       l=&quot;2&quot;        rc=&quot;1.10&quot; e=&quot; 0.0000&quot; id=&quot;N-d1&quot;/&gt;</span>
        <span class="c">#&lt;/valence_states&gt;</span>
        <span class="c">#</span>
        <span class="c"># The valence_states element contains several state elements.</span>
        <span class="c"># For this setup, the first two lines describe bound eigenstates</span>
        <span class="c"># with occupation numbers and principal quantum numbers.</span>
        <span class="c"># Notice, that the three additional unbound states should have no f and n attributes.</span>
        <span class="c"># In this way, we know that only the first two bound states (with f and n attributes)</span>
        <span class="c"># should be used for constructing an initial guess for the wave functions.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;valence_states&quot;</span><span class="p">):</span>
            <span class="n">attrib</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">attrib</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span><span class="p">[</span><span class="n">attrib</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrib</span>
        <span class="c">#print(self.valence_states)</span>

        <span class="c"># Parse the radial grids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rad_grids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;radial_grid&quot;</span><span class="p">):</span>
            <span class="n">grid_params</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">grid_params</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">gid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_grids</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rad_grids</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_grid</span><span class="p">(</span><span class="n">grid_params</span><span class="p">)</span>

<div class="viewcode-block" id="PawXmlSetup.__getstate__"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawXmlSetup.__getstate__">[docs]</a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return state is pickled as the contents for the instance.</span>
<span class="sd">                                                                                      </span>
<span class="sd">        In this case we just remove the XML root element process since Element object cannot be pickled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;_root&quot;</span><span class="p">]}</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">cElementTree</span> <span class="k">as</span> <span class="n">Et</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">Et</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zatom</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Z_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of valence electrons.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence</span>

    <span class="c"># FIXME</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maximum angular momentum.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>
                                                        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">l_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Angular momentum used for the local part.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String summarizing the most important properties.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paw_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paw_radius</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_eval_grid</span><span class="p">(</span><span class="n">grid_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function receives a dictionary with the parameters defining the</span>
<span class="sd">        radial mesh and returns a `ndarray` with the mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">grid_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;eq&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">istart</span><span class="p">,</span> <span class="n">iend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;istart&quot;</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;iend&quot;</span><span class="p">))</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span> <span class="n">iend</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">eq</span> <span class="o">==</span> <span class="s">&#39;r=a*exp(d*i)&#39;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">])</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">eq</span> <span class="o">==</span> <span class="s">&#39;r=a*i/(n-i)&#39;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">])</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">eq</span> <span class="o">==</span> <span class="s">&#39;r=a*(exp(d*i)-1)&#39;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">])</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">eq</span> <span class="o">==</span> <span class="s">&#39;r=d*i&#39;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;d&#39;</span><span class="p">])</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">eq</span> <span class="o">==</span> <span class="s">&#39;r=(i/n+a)^5/a-a^4&#39;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_params</span><span class="p">[</span><span class="s">&#39;n&#39;</span><span class="p">])</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span> <span class="o">/</span> <span class="n">a</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">4</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unknown grid type: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">eq</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_radfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the first occurence of func_name in the XML file.&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">func_name</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&quot;grid&quot;</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_grids</span><span class="p">[</span><span class="n">grid</span><span class="p">],</span> <span class="n">values</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span>

    <span class="k">def</span> <span class="nf">_parse_all_radfuncs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse all the nodes with tag func_name in the XML file.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">func_name</span><span class="p">):</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">&quot;grid&quot;</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>

            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_grids</span><span class="p">[</span><span class="n">grid</span><span class="p">],</span> <span class="n">values</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ae_core_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The all-electron radial density.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ae_core_density</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_radfunc</span><span class="p">(</span><span class="s">&quot;ae_core_density&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ae_core_density</span> <span class="o">=</span> <span class="n">RadialFunction</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ae_core_density</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pseudo_core_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The pseudized radial density.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_core_density</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_radfunc</span><span class="p">(</span><span class="s">&quot;pseudo_core_density&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_core_density</span> <span class="o">=</span> <span class="n">RadialFunction</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_core_density</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ae_partial_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary with the AE partial waves indexed by state.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ae_partial_waves</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ae_partial_waves</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_all_radfuncs</span><span class="p">(</span><span class="s">&quot;ae_partial_wave&quot;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">attrib</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span>
                <span class="n">val_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ae_partial_waves</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">RadialFunction</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="c">#print(&quot;val_state&quot;, val_state)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ae_partial_waves</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pseudo_partial_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary with the pseudo partial waves indexed by state.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_partial_waves</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_partial_waves</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_all_radfuncs</span><span class="p">(</span><span class="s">&quot;pseudo_partial_wave&quot;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">attrib</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span>
                <span class="n">val_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_partial_waves</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">RadialFunction</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudo_partial_waves</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">projector_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary with the PAW projectors indexed by state.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projector_functions</span>

        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_projector_functions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">attrib</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_all_radfuncs</span><span class="p">(</span><span class="s">&quot;projector_function&quot;</span><span class="p">):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">attrib</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span>
                <span class="n">val_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence_states</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_projector_functions</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">=</span> <span class="n">RadialFunction</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projector_functions</span>

    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="PawXmlSetup.plot_densities"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawXmlSetup.plot_densities">[docs]</a>    <span class="k">def</span> <span class="nf">plot_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the PAW densities.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib :class:`Axes` or None if a new figure should be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;r [Bohr]&#39;</span><span class="p">)</span>
        <span class="c">#ax.set_ylabel(&#39;density&#39;)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">den_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&quot;ae_core_density&quot;</span><span class="p">,</span> <span class="s">&quot;pseudo_core_density&quot;</span><span class="p">]):</span>
            <span class="n">rden</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">den_name</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;$n_c$&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;$</span><span class="se">\\</span><span class="s">tilde{n}_c$&quot;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rden</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">rden</span><span class="o">.</span><span class="n">mesh</span> <span class="o">*</span> <span class="n">rden</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="PawXmlSetup.plot_waves"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawXmlSetup.plot_waves">[docs]</a>    <span class="k">def</span> <span class="nf">plot_waves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the AE and the pseudo partial waves.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib :class:`Axes` or None if a new figure should be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;r [Bohr]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$r\phi,</span><span class="se">\\</span><span class="s">, r</span><span class="se">\\</span><span class="s">tilde\phi\, [Bohr]^{-</span><span class="se">\\</span><span class="s">frac{1}{2}}$&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paw_radius</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
        <span class="c">#ax.annotate(&quot;$r_c$&quot;, xy=(self.paw_radius + 0.1, 0.1))</span>

        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">rfunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_partial_waves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span> <span class="o">*</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;PS-WAVE: &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">rfunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ae_partial_waves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span> <span class="o">*</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;AE-WAVE: &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="PawXmlSetup.plot_projectors"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PawXmlSetup.plot_projectors">[docs]</a>    <span class="k">def</span> <span class="nf">plot_projectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the PAW projectors.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib :class:`Axes` or None if a new figure should be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="s">&quot;Projectors&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;r [Bohr]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$r</span><span class="se">\\</span><span class="s">tilde p\, [Bohr]^{-</span><span class="se">\\</span><span class="s">frac{1}{2}}$&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">paw_radius</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">)</span>
        <span class="c">#ax.annotate(&quot;$r_c$&quot;, xy=(self.paw_radius + 0.1, 0.1))</span>

        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">rfunc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">projector_functions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">mesh</span> <span class="o">*</span> <span class="n">rfunc</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;TPROJ: &quot;</span> <span class="o">+</span> <span class="n">state</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="c">#@add_fig_kwargs</span>
    <span class="c">#def plot_potentials(self, **kwargs):</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#        ================  ==============================================================</span>
    <span class="c">#        kwargs            Meaning</span>
    <span class="c">#        ================  ==============================================================</span>
    <span class="c">#        title             Title of the plot (Default: None).</span>
    <span class="c">#        show              True to show the figure (Default).</span>
    <span class="c">#        savefig           &#39;abc.png&#39; or &#39;abc.eps&#39; to save the figure to a file.</span>
    <span class="c">#        ================  ==============================================================</span>

    <span class="c">#    Returns:</span>
    <span class="c">#        `matplotlib` figure</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    title = kwargs.pop(&quot;title&quot;, &quot;Potentials&quot;)</span>
    <span class="c">#    show = kwargs.pop(&quot;show&quot;, True)</span>
    <span class="c">#    savefig = kwargs.pop(&quot;savefig&quot;, None)</span>

    <span class="c">#    import matplotlib.pyplot as plt</span>

    <span class="c">#    fig = plt.figure()</span>

    <span class="c">#    ax = fig.add_subplot(1,1,1)</span>
    <span class="c">#    ax.grid(True)</span>
    <span class="c">#    ax.set_xlabel(&#39;r [Bohr]&#39;)</span>
    <span class="c">#    ax.set_ylabel(&#39;density&#39;)</span>
    <span class="c">#    ax.axvline(x=self.paw_radius, linewidth=2, color=&#39;k&#39;, linestyle=&quot;--&quot;)</span>
    <span class="c">#    ax.annotate(&quot;$r_c$&quot;, xy=(self.paw_radius + 0.1, 0.1))</span>

    <span class="c">#    for state, rfunc in self.potentials.items():</span>
    <span class="c">#        ax.plot(rfunc.mesh, rfunc.values, label=&quot;TPROJ: &quot; + state)</span>

    <span class="c">#    plt.legend(loc=&quot;best&quot;)</span>

    <span class="c">#    if title is not None: fig.suptitle(title)</span>
    <span class="c">#    if show: plt.show()</span>
    <span class="c">#    if savefig: fig.savefig(savefig)</span>
    <span class="c">#    return fig</span>

</div></div>
<div class="viewcode-block" id="PseudoTable"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable">[docs]</a><span class="k">class</span> <span class="nc">PseudoTable</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">PMGSONable</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the pseudopotentials from the element table.</span>
<span class="sd">    Individidual elements are accessed by name, symbol or atomic number.</span>

<span class="sd">    For example, the following all retrieve iron:</span>

<span class="sd">    print elements[26]</span>
<span class="sd">    Fe</span>
<span class="sd">    print elements.Fe</span>
<span class="sd">    Fe</span>
<span class="sd">    print elements.symbol(&#39;Fe&#39;)</span>
<span class="sd">    Fe</span>
<span class="sd">    print elements.name(&#39;iron&#39;)</span>
<span class="sd">    Fe</span>
<span class="sd">    print elements.isotope(&#39;Fe&#39;)</span>
<span class="sd">    Fe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PseudoTable.as_table"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.as_table">[docs]</a>    <span class="k">def</span> <span class="nf">as_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an instance of :class:`PseudoTable` from the iterable items.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span> <span class="k">return</span> <span class="n">items</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PseudoTable.from_dir"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.from_dir">[docs]</a>    <span class="k">def</span> <span class="nf">from_dir</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">exts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="s">&quot;_*&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all pseudos in the directory tree starting from top.</span>

<span class="sd">        Args:</span>
<span class="sd">            top: Top of the directory tree</span>
<span class="sd">            exts: List of files extensions. if exts == &quot;all_files&quot;</span>
<span class="sd">                    we try to open all files in top</span>
<span class="sd">            exclude_dirs: Wildcard used to exclude directories.</span>
<span class="sd">        </span>
<span class="sd">        return: :class:`PseudoTable` sorted by atomic number Z.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">exts</span> <span class="o">==</span> <span class="s">&quot;all_files&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">top</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">Pseudo</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">pseudos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Skipping file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Skipping file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pseudos</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No pseudopotentials parsed from folder </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">top</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Creating PseudoTable with </span><span class="si">%i</span><span class="s"> pseudopotentials&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pseudos</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">exts</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;psp8&quot;</span><span class="p">,)</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">find_exts</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">exts</span><span class="p">,</span> <span class="n">exclude_dirs</span><span class="o">=</span><span class="n">exclude_dirs</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pseudos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Pseudo</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;Error in </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span><span class="o">.</span><span class="n">sort_by_z</span><span class="p">()</span>

    <span class="c">#@pmg_serialize</span>
    <span class="c">#def as_dict(self, **kwargs):</span>
    <span class="c">#    return {pseudo.as_dict() for pseudo in self}</span>

    <span class="c">#@classmethod</span>
    <span class="c">#def from_dict(cls, d):</span>
    <span class="c">#    pseudos = [p.from_dict(d) for k, p in cls.as_dict().items() if not k.startswith(&quot;@&quot;)]</span>
    <span class="c">#    print(pseudos)</span>
    <span class="c">#    #return cls(pseudos)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pseudos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            pseudos: List of pseudopotentials or filepaths</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Store pseudos in a default dictionary with z as key.</span>
        <span class="c"># Note that we can have more than one pseudo for given z.</span>
        <span class="c"># hence the values are lists of pseudos.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pseudos</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
            <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[</span><span class="n">pseudos</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_string</span><span class="p">(</span><span class="n">pseudos</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">pseudos</span> <span class="o">=</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="n">pseudos</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">pseudo</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pseudo</span><span class="p">,</span> <span class="n">Pseudo</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">Pseudo</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">pseudo</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlist</span><span class="p">:</span>
            <span class="n">pseudo_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="p">[</span><span class="n">z</span><span class="p">]</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pseudo_list</span><span class="p">]</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">symb</span> <span class="o">!=</span> <span class="n">symbol</span> <span class="k">for</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;All symbols must be equal while they are: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">pseudo_list</span><span class="p">)</span>

<div class="viewcode-block" id="PseudoTable.__getitem__"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve pseudos for the atomic number z. Accepts both int and slice objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">Z</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
            <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">znum</span> <span class="ow">in</span> <span class="n">iterator_from_slice</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
                <span class="n">pseudos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="p">[</span><span class="n">znum</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="p">[</span><span class="n">Z</span><span class="p">])</span>
</div>
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__iter__</span><span class="p">()))</span>

<div class="viewcode-block" id="PseudoTable.__iter__"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process the elements in Z order.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">zlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="p">[</span><span class="n">z</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="n">pseudo</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span>
        <span class="n">app</span><span class="p">(</span><span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s">, len=</span><span class="si">%d</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">app</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pseudo</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allnc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if all pseudos are norm-conserving.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">isnc</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allpaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if all pseudos are PAW.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ispaw</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ordered list with the atomic numbers available in the table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pseudos_with_z</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<div class="viewcode-block" id="PseudoTable.as_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="mi">1</span>
            <span class="c"># Handle multiple-pseudos with the same name!</span>
            <span class="k">while</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()})</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;@module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;@class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">return</span> <span class="n">d</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="PseudoTable.from_dict"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.from_dict">[docs]</a>    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">MontyDecoder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pseudos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dec</span><span class="o">.</span><span class="n">process_decoded</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PseudoTable.is_complete"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.is_complete">[docs]</a>    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mi">118</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if table is complete i.e. all elements with Z &lt; zmax have at least on pseudopotential</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zmax</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">[</span><span class="n">z</span><span class="p">]:</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="PseudoTable.pseudo_with_symbol"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.pseudo_with_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">pseudo_with_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the pseudo with the given chemical symbol.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError if symbol is not found or multiple occurences are present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_symbols</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">ret_list</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pseudos</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Found </span><span class="si">%d</span><span class="s"> occurrences of symbol </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pseudos</span><span class="p">),</span> <span class="n">symbol</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pseudos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PseudoTable.pseudos_with_symbols"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.pseudos_with_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">pseudos_with_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the pseudos with the given chemical symbols.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError if one of the symbols is not found or multiple occurences are present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">ret_list</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">found_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pseudos</span><span class="p">]</span>
        <span class="n">duplicated_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">found_symbols</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">duplicated_elements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Found multiple occurrences of symbol(s) </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">duplicated_elements</span><span class="p">))</span>
        <span class="n">missing_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found_symbols</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_symbols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Missing data for symbol(s) </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_symbols</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pseudos</span>
</div>
<div class="viewcode-block" id="PseudoTable.select_symbols"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.select_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">select_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">ret_list</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a :class:`PseudoTable` with the pseudopotentials with the given list of chemical symbols.</span>

<span class="sd">        Args:</span>
<span class="sd">            symbols: str or list of symbols</span>
<span class="sd">                Prepend the symbol string with &quot;-&quot;, to exclude pseudos.</span>
<span class="sd">            ret_list: if True a list of pseudos is returned instead of a :class:`PseudoTable`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;When excluding symbols, all strings must start with `-`&quot;</span><span class="p">)</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">]</span>
            <span class="c">#print(symbols)</span>

        <span class="n">symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span> <span class="k">continue</span>

            <span class="n">pseudos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">ret_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pseudos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PseudoTable.get_pseudos_for_structure"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.get_pseudos_for_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_pseudos_for_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the list of :class:`Pseudo` objects to be used for this :class:`Structure`.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure: pymatgen :class:`Structure`.</span>

<span class="sd">        Raises:</span>
<span class="sd">            `ValueError` if one of the chemical symbols is not found or </span>
<span class="sd">            multiple occurences are present in the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">symbol_set</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudos_with_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>


    <span class="c">#def list_properties(self, *props, **kw):</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    Print a list of elements with the given set of properties.</span>

    <span class="c">#    Args:</span>
    <span class="c">#        *prop1*, *prop2*, ... : string</span>
    <span class="c">#            Name of the properties to print</span>
    <span class="c">#        *format*: string</span>
    <span class="c">#            Template for displaying the element properties, with one</span>
    <span class="c">#            % for each property.</span>

    <span class="c">#    For example, print a table of mass and density.</span>

    <span class="c">#    from periodictable import elements</span>
    <span class="c">#    elements.list_properties(&#39;symbol&#39;,&#39;mass&#39;,&#39;density&#39;, format=&quot;%-2s: %6.2f u %5.2f g/cm^3&quot;)</span>
    <span class="c">#    H :   1.01 u   0.07 g/cm^3</span>
    <span class="c">#    He:   4.00 u   0.12 g/cm^3</span>
    <span class="c">#    Li:   6.94 u   0.53 g/cm^3</span>
    <span class="c">#    ...</span>
    <span class="c">#    Bk: 247.00 u  14.00 g/cm^3</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    format = kw.pop(&#39;format&#39;, None)</span>
    <span class="c">#    assert len(kw) == 0</span>

    <span class="c">#    for pseudo in self:</span>
    <span class="c">#        try:</span>
    <span class="c">#            values = tuple(getattr(pseudo, p) for p in props)</span>
    <span class="c">#        except AttributeError:</span>
    <span class="c">#            # Skip elements which don&#39;t define all the attributes</span>
    <span class="c">#            continue</span>

    <span class="c">#        # Skip elements with a value of None</span>
    <span class="c">#        if any(v is None for v in values):</span>
    <span class="c">#            continue</span>

    <span class="c">#        if format is None:</span>
    <span class="c">#            print(&quot; &quot;.join(str(p) for p in values))</span>
    <span class="c">#        else:</span>
    <span class="c">#            try:</span>
    <span class="c">#                print(format % values)</span>
    <span class="c">#            except:</span>
    <span class="c">#                print(&quot;format&quot;,format,&quot;args&quot;,values)</span>
    <span class="c">#                raise</span>

    <span class="c">#def print_table(self, stream=sys.stdout, filter_function=None):</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    A pretty ASCII printer for the periodic table, based on some filter_function.</span>
    <span class="c">#    Args:</span>
    <span class="c">#        filter_function:</span>
    <span class="c">#            A filtering function that take a Pseudo as input and returns a boolean.</span>
    <span class="c">#            For example, setting filter_function = lambda el: el.Z_val &gt; 2 will print</span>
    <span class="c">#            a periodic table containing only pseudos with Z_val &gt; 2.</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    for row in range(1, 10):</span>
    <span class="c">#        rowstr = []</span>
    <span class="c">#        for group in range(1, 19):</span>
    <span class="c">#            el = Element.from_row_and_group(row, group)</span>
    <span class="c">#            if el and ((not filter_function) or filter_function(el)):</span>
    <span class="c">#                rowstr.append(&quot;{:3s}&quot;.format(el.symbol))</span>
    <span class="c">#            else:</span>
    <span class="c">#                rowstr.append(&quot;   &quot;)</span>
    <span class="c">#        print(&quot; &quot;.join(rowstr))</span>
</div>
<div class="viewcode-block" id="PseudoTable.sorted"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.sorted">[docs]</a>    <span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the table according to the value of attribute attrname.</span>

<span class="sd">        Return:</span>
<span class="sd">            New class:`PseudoTable` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pseudo</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

        <span class="c"># Sort attrs, and build new table with sorted pseudos.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">([</span><span class="bp">self</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="PseudoTable.sort_by_z"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.sort_by_z">[docs]</a>    <span class="k">def</span> <span class="nf">sort_by_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a new :class:`PseudoTable` with pseudos sorted by Z&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PseudoTable.select"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select only those pseudopotentials for which condition is True.</span>
<span class="sd">        Return new class:`PseudoTable` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            condition:</span>
<span class="sd">                Function that accepts a :class:`Pseudo` object and returns True or False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="PseudoTable.with_dojo_report"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.with_dojo_report">[docs]</a>    <span class="k">def</span> <span class="nf">with_dojo_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select pseudos containing the DOJO_REPORT section. Return new class:`PseudoTable` object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">has_dojo_report</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PseudoTable.get_dojo_dataframe"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.get_dojo_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">get_dojo_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Buid a pandas :class:`DataFrame` with the most important parameters extracted from the </span>
<span class="sd">        `DOJO_REPORT` section of each pseudo in the table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            frame, errors</span>

<span class="sd">            where frame is the pandas :class:`DataFrame` and errors is a list of errors</span>
<span class="sd">            encountered while trying to read the `DOJO_REPORT` from the pseudopotential file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accuracies</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;low&quot;</span><span class="p">,</span> <span class="s">&quot;normal&quot;</span><span class="p">,</span> <span class="s">&quot;high&quot;</span><span class="p">]</span>

        <span class="n">trial2keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;deltafactor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;dfact_meV&quot;</span><span class="p">,</span> <span class="s">&quot;dfactprime_meV&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;v0&quot;</span><span class="p">,</span> <span class="s">&quot;b0_GPa&quot;</span><span class="p">,</span> <span class="s">&quot;b1&quot;</span><span class="p">],</span> 
            <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;a0_rel_err&quot;</span><span class="p">],</span>
            <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;a0_rel_err&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">rows</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">report</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">dojo_report</span>
            <span class="k">assert</span> <span class="s">&quot;version&quot;</span>  <span class="ow">in</span> <span class="n">report</span>
            <span class="c">#if &quot;version&quot; not in report:</span>
            <span class="c">#    print(&quot;ignoring old report in &quot;, p.basename)</span>
            <span class="c">#    continue</span>

            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;symbol&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="s">&quot;Z&quot;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Z</span><span class="p">}</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>

            <span class="c"># FIXME</span>
            <span class="n">ecut_acc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">low</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">ecuts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">normal</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">ecuts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">high</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">ecuts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_ecut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecut_acc</span><span class="p">[</span><span class="n">acc</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">trial</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">trial2keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">:</span>
                        <span class="n">ecut</span> <span class="o">=</span> <span class="n">ecut_acc</span><span class="p">[</span><span class="n">acc</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;gbrv&quot;</span><span class="p">):</span>
                            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">trial</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ecut</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">})</span> 
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ecut</span><span class="p">][</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">})</span> 

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> raised </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)))</span>

            <span class="c">#print(d)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="c"># Build sub-class of pandas.DataFrame</span>
        <span class="k">return</span> <span class="n">DojoDataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">names</span><span class="p">),</span> <span class="n">errors</span>
</div>
<div class="viewcode-block" id="PseudoTable.select_rows"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.select_rows">[docs]</a>    <span class="k">def</span> <span class="nf">select_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return new class:`PseudoTable` object with pseudos in the given rows of the periodic table.</span>
<span class="sd">        rows can be either a int or a list of integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span> <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="PseudoTable.select_family"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.select_family">[docs]</a>    <span class="k">def</span> <span class="nf">select_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">):</span>
        <span class="c"># e.g element.is_alkaline</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="s">&quot;is_&quot;</span> <span class="o">+</span> <span class="n">family</span><span class="p">)])</span>
</div>
<div class="viewcode-block" id="PseudoTable.dojo_compare"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.PseudoTable.dojo_compare">[docs]</a>    <span class="k">def</span> <span class="nf">dojo_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare ecut convergence and Deltafactor, GBRV results&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="n">show</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">what</span> <span class="o">=</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">has_trial</span><span class="p">(</span><span class="s">&quot;deltafactor&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">what</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;ecut&quot;</span><span class="p">)):</span>

            <span class="n">fig_etotal</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=len(self), ncols=1, sharex=True, squeeze=True)</span>
            <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig_etotal</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_list</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
                <span class="n">pseudo</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">plot_etotal_vs_ecut</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">pseudo</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">has_trial</span><span class="p">(</span><span class="s">&quot;deltafactor&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">what</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;df&quot;</span><span class="p">,</span> <span class="s">&quot;deltafactor&quot;</span><span class="p">)):</span>

            <span class="n">fig_deltafactor</span><span class="p">,</span> <span class="n">ax_grid</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=5, ncols=len(self), sharex=True, sharey=&quot;row&quot;, squeeze=False))</span>
            <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig_deltafactor</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_grid</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
                <span class="n">pseudo</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">plot_deltafactor_convergence</span><span class="p">(</span><span class="n">ax_list</span><span class="o">=</span><span class="n">ax_list</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="n">fig_deltafactor</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&quot; vs &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">basename</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c"># Compare GBRV results</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">has_trial</span><span class="p">(</span><span class="s">&quot;gbrv_bcc&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">what</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;gbrv&quot;</span><span class="p">)):</span>

            <span class="n">fig_gbrv</span><span class="p">,</span> <span class="n">ax_grid</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig_gbrv</span><span class="p">)</span>
            <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, ncols=len(self), sharex=True, sharey=&quot;row&quot;, squeeze=False))</span>

            <span class="k">for</span> <span class="n">ax_list</span><span class="p">,</span> <span class="n">pseudo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_grid</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
                <span class="n">pseudo</span><span class="o">.</span><span class="n">dojo_report</span><span class="o">.</span><span class="n">plot_gbrv_convergence</span><span class="p">(</span><span class="n">ax_list</span><span class="o">=</span><span class="n">ax_list</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="n">fig_gbrv</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&quot; vs &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">basename</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">figs</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">replacement</span><span class="o">=</span><span class="n">from_dir</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">pseudos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">Pseudo</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">pseudos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Skipping file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Skipping file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pseudos</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;No pseudopotentials parsed from folder </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Creating PseudoTable with </span><span class="si">%i</span><span class="s"> pseudopotentials&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">pseudos</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">pseudos</span><span class="p">)</span>
</div>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">DataFrame</span> <span class="o">=</span> <span class="nb">object</span>

<div class="viewcode-block" id="DojoDataFrame"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame">[docs]</a><span class="k">class</span> <span class="nc">DojoDataFrame</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="n">ALL_ACCURACIES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span> <span class="s">&quot;normal&quot;</span><span class="p">,</span> <span class="s">&quot;high&quot;</span><span class="p">)</span>

    <span class="n">ALL_TRIALS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&quot;ecut&quot;</span><span class="p">,</span>
        <span class="s">&quot;deltafactor&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_TRIALS2KEY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;ecut&quot;</span><span class="p">:</span> <span class="s">&quot;ecut&quot;</span><span class="p">,</span>
        <span class="s">&quot;deltafactor&quot;</span><span class="p">:</span> <span class="s">&quot;dfact_meV&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">:</span> <span class="s">&quot;gbrv_bcc_a0_rel_err&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">:</span> <span class="s">&quot;gbrv_fcc_a0_rel_err&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_TRIALS2YLABEL</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;ecut&quot;</span><span class="p">:</span> <span class="s">&quot;Ecut [Ha]&quot;</span><span class="p">,</span>
        <span class="s">&quot;deltafactor&quot;</span><span class="p">:</span> <span class="s">&quot;$\Delta$-factor [meV]&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">:</span> <span class="s">&quot;BCC $\Delta a_0$ (%)&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">:</span> <span class="s">&quot;FCC $\Delta a_0$ (%)&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">ACC2PLTOPTS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">low</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">),</span>
        <span class="n">normal</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">),</span>
        <span class="n">high</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ACC2PLTOPTS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">v</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<div class="viewcode-block" id="DojoDataFrame.tabulate"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.tabulate">[docs]</a>    <span class="k">def</span> <span class="nf">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">accuracies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_dfact_meV&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
            <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_ecut&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
            <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_gbrv_fcc_a0_rel_err&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
            <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_gbrv_bcc_a0_rel_err&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 

        <span class="c">#return self[columns].to_html()</span>
        <span class="n">tablefmt</span> <span class="o">=</span> <span class="s">&quot;grid&quot;</span>
        <span class="n">floatfmt</span><span class="o">=</span><span class="s">&quot;.2f&quot;</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">columns</span><span class="p">],</span> <span class="n">headers</span><span class="o">=</span><span class="s">&quot;keys&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="n">tablefmt</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="n">floatfmt</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="DojoDataFrame.get_accuracy"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.get_accuracy">[docs]</a>    <span class="k">def</span> <span class="nf">get_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DojoDataFrame.get_trials"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.get_trials">[docs]</a>    <span class="k">def</span> <span class="nf">get_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accuracies</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">):</span>
        <span class="n">accuracies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span> <span class="k">if</span> <span class="n">accuracies</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span> <span class="k">else</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">accuracies</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_dfact_meV&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
        <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_ecut&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
        <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_gbrv_fcc_a0_rel_err&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
        <span class="n">columns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_gbrv_bcc_a0_rel_err&quot;</span> <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">]</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DojoDataFrame.select_rows"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.select_rows">[docs]</a>    <span class="k">def</span> <span class="nf">select_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span> <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">_PTABLE</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DojoDataFrame.select_family"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.select_family">[docs]</a>    <span class="k">def</span> <span class="nf">select_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">_PTABLE</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span>
            <span class="c"># e.g element.is_alkaline</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s">&quot;is_&quot;</span> <span class="o">+</span> <span class="n">family</span><span class="p">):</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoDataFrame.plot_hist"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.plot_hist">[docs]</a>    <span class="k">def</span> <span class="nf">plot_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="s">&quot;dfact_meV&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=len(self.ALL_ACCURACIES), ncols=1, sharex=True, sharey=False, squeeze=True)</span>

        <span class="k">for</span> <span class="n">acc</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">what</span>
            <span class="c">#print(col)</span>
            <span class="c">#self[col].hist(ax=ax, bins=bins, label=col)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoDataFrame.plot_trials"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoDataFrame.plot_trials">[docs]</a>    <span class="k">def</span> <span class="nf">plot_trials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">accuracies</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="n">trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_TRIALS</span> <span class="k">if</span> <span class="n">trials</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span> <span class="k">else</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">trials</span><span class="p">)</span>
        <span class="n">accuracies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span> <span class="k">if</span> <span class="n">accuracies</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span> <span class="k">else</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">accuracies</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">trials</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=len(trials), ncols=1, sharex=True, sharey=False, squeeze=True)</span>
                                                                                                                      
        <span class="c"># See also http://matplotlib.org/examples/pylab_examples/barchart_demo.html</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">trials</span><span class="p">,</span> <span class="n">ax_list</span><span class="p">)):</span>
            <span class="n">what</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TRIALS2KEY</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_TRIALS2YLABEL</span><span class="p">[</span><span class="n">trial</span><span class="p">])</span>
            <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">accuracies</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">acc</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">what</span>
                <span class="n">legend</span> <span class="o">=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> 
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
                <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minval</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxval</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span> <span class="n">use_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">acc</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ACC2PLTOPTS</span><span class="p">[</span><span class="n">acc</span><span class="p">])</span>
                <span class="c">#data.plot(ax=ax, kind=&quot;bar&quot;) </span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#fancybox=True)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="c">#ax.set_xticklabels([root for root, ext in map(os.path.splitext, data.index)])</span>

            <span class="c"># Set ylimits</span>
            <span class="c">#stepsize = None</span>
            <span class="c">#if &quot;gbrv&quot; in trial: </span>
            <span class="c">#    ax.hlines(0.0, 0, len(data.index))</span>
            <span class="c">#    #start, end = -0.6, +0.6</span>
            <span class="c">#    start, end = max(-0.6, minval), min(+0.6, maxval)</span>
            <span class="c">#    if end - start &lt; 0.05: end = start + 0.1</span>
            <span class="c">#    ax.set_ylim(start, end)</span>
            <span class="c">#    ax.yaxis.set_ticks(np.arange(start, end, 0.05))</span>

            <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="s">&quot;deltafactor&quot;</span><span class="p">:</span>
                <span class="c">#start, end = 0.0, 15</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span>  <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
                <span class="c">#ax.yaxis.set_ticks(np.arange(start, end, 0.1))</span>

            <span class="c">#if stepsize is not None:</span>
            <span class="c">#    start, end = ax.get_ylim()</span>
            <span class="c">#    ax.yaxis.set_ticks(np.arange(start, end, stepsize))</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="c">#def sns_plot(self):</span>
    <span class="c">#    import seaborn as sns</span>
    <span class="c">#    import matplotlib.pyplot as plt</span>
    <span class="c">#    #self.plot(x=&quot;symbol&quot;, y=&quot;high_dfact_meV&quot;, use_index=True)</span>
    <span class="c">#    #data = calc_rerrors(data)</span>
    <span class="c">#    g = sns.PairGrid(self, x_vars=&quot;Z&quot;, y_vars=[</span>
    <span class="c">#        &quot;low_ecut&quot;,</span>
    <span class="c">#        &quot;low_dfact_meV&quot;,</span>
    <span class="c">#        #&quot;high_dfact_meV&quot;, </span>
    <span class="c">#        #&quot;low_v0_rerr&quot;, &quot;low_b0_GPa_rerr&quot;, &quot;low_b1_rerr&quot;,</span>
    <span class="c">#        ]</span>
    <span class="c">#    ) #, hue=&quot;smoker&quot;)</span>
    <span class="c">#    g.map(plt.scatter)</span>
    <span class="c">#    g.add_legend()</span>
    <span class="c">#    plt.show()</span>

</div></div>
<div class="viewcode-block" id="DojoReport"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport">[docs]</a><span class="k">class</span> <span class="nc">DojoReport</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dict-like object with the dojo report.&quot;&quot;&quot;</span>

    <span class="n">_TRIALS2KEY</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;deltafactor&quot;</span><span class="p">:</span> <span class="s">&quot;dfact_meV&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">:</span> <span class="s">&quot;a0_rel_err&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">:</span> <span class="s">&quot;a0_rel_err&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">ALL_ACCURACIES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">,</span> <span class="s">&quot;normal&quot;</span><span class="p">,</span> <span class="s">&quot;high&quot;</span><span class="p">)</span>

    <span class="n">ALL_TRIALS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&quot;deltafactor&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_bcc&quot;</span><span class="p">,</span>
        <span class="s">&quot;gbrv_fcc&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ATOLS</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DojoReport.from_file"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.from_file">[docs]</a>    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the DojoReport from file.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>

            <span class="n">stop</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;&lt;/DOJO_REPORT&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">stop</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="DojoReport.from_hints"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.from_hints">[docs]</a>    <span class="k">def</span> <span class="nf">from_hints</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ppgen_ecut</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the DojoReport from an initial value of ecut in Hartree.&quot;&quot;&quot;</span>
        <span class="n">dense_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ppgen_ecut</span><span class="p">,</span> <span class="n">ppgen_ecut</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dense_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ppgen_ecut</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ppgen_ecut</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">coarse_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ppgen_ecut</span> <span class="o">+</span> <span class="mi">15</span><span class="p">,</span> <span class="n">ppgen_ecut</span> <span class="o">+</span> <span class="mi">35</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">ecut_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dense_left</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">dense_right</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">coarse_high</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">ecut_list</span><span class="o">=</span><span class="n">ecut_list</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span> <span class="c">#, **{k: {}: for k in self.ALL_TRIALS})</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="nb">super</span><span class="p">(</span><span class="n">DojoReport</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_TRIALS</span><span class="p">:</span>
            <span class="c"># Convert ecut to float and build an OrderedDict (results are indexed by ecut in ascending order)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">ecuts_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">ord</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ecuts_keys</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<div class="viewcode-block" id="DojoReport.has_exceptions"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.has_exceptions">[docs]</a>    <span class="k">def</span> <span class="nf">has_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">problems</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_TRIALS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">accuracy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_ACCURACIES</span><span class="p">:</span>
                <span class="n">excs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">][</span><span class="n">accuracy</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;_exceptions&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">excs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">trial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">problems</span><span class="p">:</span> <span class="n">problems</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="n">problems</span><span class="p">[</span><span class="n">trial</span><span class="p">][</span><span class="n">accuracy</span><span class="p">]</span> <span class="o">=</span> <span class="n">excs</span>

        <span class="k">return</span> <span class="n">problems</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Chemical symbol.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;symbol&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if hints are present.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;hints&quot;</span> <span class="ow">in</span> <span class="bp">self</span>

    <span class="nd">@lazy_property</span>
<div class="viewcode-block" id="DojoReport.ecuts"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.ecuts">[docs]</a>    <span class="k">def</span> <span class="nf">ecuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s">&quot;ecuts&quot;</span><span class="p">])</span>

    <span class="c">#@property</span>
    <span class="c">#def is_validated(self)</span>
    <span class="c">#    return bool(self.get(&quot;validated&quot;, False))</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List of strings with the trials present in the report.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&quot;hints&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="DojoReport.has_trial"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.has_trial">[docs]</a>    <span class="k">def</span> <span class="nf">has_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dojo_trial</span><span class="p">,</span> <span class="n">ecut</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the dojo_report contains dojo_trial with the given ecut.</span>
<span class="sd">        If ecut is not, we test if dojo_trial is present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ecut</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dojo_trial</span> <span class="ow">in</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">dojo_trial</span><span class="p">][</span><span class="n">ecut</span><span class="p">]</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="c">#def missing_ecuts(self, trial):</span>
    <span class="c">#    computed_ecuts = self[trial].keys()</span>
    <span class="c">#    return [e for e in self.ecuts if e not in computed_ecuts]</span>

    <span class="c">#def add_ecuts(self, ecuts):</span>
        <span class="c"># Be careful with the format here! it should be %.1f</span>
        <span class="c">#new_ecuts = np.array(new_ecuts.split(&quot;,&quot;))</span>

    <span class="c">#def validate(self, hints):</span>
    <span class="c">#    Add md5 hash value</span>
    <span class="c">#    self[&quot;validated&quot;] = True</span>
</div>
<div class="viewcode-block" id="DojoReport.check"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check the DojoReport. Test if each trial contains an ecut entry. </span>
<span class="sd">        Return a dictionary trial: [missing_ecut]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALL_TRIALS</span><span class="p">:</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Gbrv results do not contain noble gases so ignore the error</span>
                <span class="k">if</span> <span class="s">&quot;gbrv&quot;</span> <span class="ow">in</span> <span class="n">trial</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">is_noble_gas</span><span class="p">:</span> 
                    <span class="k">assert</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span>
                    <span class="k">continue</span>
                <span class="n">d</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecuts</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">computed_ecuts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecuts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">computed_ecuts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">trial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">computed_ecuts</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ecuts</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="c">#def get_dataframe(self, **kwargs):</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    ===========  ===============  ===============   ===============</span>
    <span class="c">#    Trial             low              normal            high </span>
    <span class="c">#    ===========  ===============  ===============   ===============</span>
    <span class="c">#    deltafactor  value (rel_err)  value (rel_err)   value (rel_err)</span>
    <span class="c">#    gbrv_fcc     ...              ...               ...</span>
    <span class="c">#    ===========  ===============  ===============   ===============</span>
    <span class="c">#    &quot;&quot;&quot;</span>
    <span class="c">#    # Build the header</span>
    <span class="c">#    if kwargs.pop(&quot;with_hints&quot;, True):</span>
    <span class="c">#        ecut_acc = {acc: self[&quot;hints&quot;][acc][&quot;ecut&quot;] for acc in self.ALL_ACCURACIES}</span>
    <span class="c">#        l = [&quot;%s (%s Ha)&quot; % (acc, ecut_acc[acc]) for acc in self.ALL_ACCURACIES]</span>
    <span class="c">#    else:</span>
    <span class="c">#        l = list(self.ALL_ACCURACIES)</span>

    <span class="c">#    rows = [[&quot;Trial&quot;] + l]</span>

    <span class="c">#    for trial in self.ALL_TRIALS:</span>
    <span class="c">#        row = [trial]</span>
    <span class="c">#        for accuracy in self.ALL_ACCURACIES:</span>
    <span class="c">#            if not self.has_trial(trial, accuracy): </span>
    <span class="c">#                row.append(&quot;N/A&quot;)</span>
    <span class="c">#            else:</span>
    <span class="c">#                d = self[trial][accuracy]</span>
    <span class="c">#                value = d[self._TRIALS2KEY[trial]]</span>
    <span class="c">#                s = &quot;%.4f&quot; % value</span>
    <span class="c">#                row.append(s)</span>
    <span class="c">#        rows.append(row)</span>
    <span class="c">#    #import pandas as pd</span>
    <span class="c">#    #return pd.DataFrame(rows, index=names, columns=columns)</span>
    <span class="c">#    return rows</span>
</div>
<div class="viewcode-block" id="DojoReport.print_table"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.print_table">[docs]</a>    <span class="k">def</span> <span class="nf">print_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">monty.pprint</span> <span class="kn">import</span> <span class="n">pprint_table</span>
        <span class="n">pprint_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(),</span> <span class="n">out</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoReport.plot_etotal_vs_ecut"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.plot_etotal_vs_ecut">[docs]</a>    <span class="k">def</span> <span class="nf">plot_etotal_vs_ecut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inv_ecut</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot the convergence of the total energy as function of the energy cutoff ecut</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib Axes, if ax is None a new figure is created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Extract the total energy of the AE relaxed structure (4).</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">ecut</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;etotals&quot;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">ecut</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;deltafactor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

        <span class="c"># Ecut mesh in Ha</span>
        <span class="n">ecuts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">ecut_min</span><span class="p">,</span> <span class="n">ecut_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ecuts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ecuts</span><span class="p">)</span>

        <span class="c"># Energies per atom in meV and difference wrt &#39;converged&#39; value</span>
        <span class="n">num_sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s">&quot;num_sites&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;deltafactor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">etotals_mev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ecuts</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="o">/</span> <span class="n">num_sites</span>
        <span class="n">ediffs</span> <span class="o">=</span> <span class="n">etotals_mev</span> <span class="o">-</span> <span class="n">etotals_mev</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="c">#ax.yaxis.set_view_interval(-5, 5)</span>

        <span class="n">lines</span><span class="p">,</span> <span class="n">legends</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">ecuts</span> <span class="k">if</span> <span class="n">inv_ecut</span> <span class="k">else</span> <span class="n">ecuts</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">etotals_mev</span> <span class="k">if</span> <span class="n">inv_ecut</span> <span class="k">else</span> <span class="n">ediffs</span>

        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="s">&quot;--&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;label&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">high_hint</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;ppgen_hints&quot;</span><span class="p">][</span><span class="s">&quot;high&quot;</span><span class="p">][</span><span class="s">&quot;ecut&quot;</span><span class="p">]</span>
        <span class="c">#ax.vlines(high_hint, min(ediffs), max(ediffs))</span>
        <span class="c">#ax.vlines(high_hint, 0.5, 1.5)</span>
        <span class="c">#ax.scatter([high_hint], [1.0], s=20) #, c=&#39;b&#39;, marker=&#39;o&#39;, cmap=None, norm=None)</span>
        <span class="c">#ax.arrow(high_hint, 1, 0, 0.2, head_width=0.05, head_length=0.1, fc=&#39;k&#39;, ec=&#39;k&#39;,head_starts_at_zero=False)</span>

        <span class="c">#ax.hlines(5, ecut_min, ecut_max, label=&quot;5.0&quot;)</span>
        <span class="c">#ax.hlines(1, ecut_min, ecut_max, label=&quot;1.0&quot;)</span>
        <span class="c">#ax.hlines(0.5, ecut_min, ecut_max, label=&quot;0.2&quot;)</span>

        <span class="c"># Set xticks and labels.</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Ecut [Ha]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;Delta Etotal/natom [meV]&quot;</span><span class="p">)</span>
        <span class="c">#ax.set_xlim(0, max(xs))</span>

        <span class="c"># Use logscale if possible.</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">ediffs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> 
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoReport.plot_deltafactor_eos"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.plot_deltafactor_eos">[docs]</a>    <span class="k">def</span> <span class="nf">plot_deltafactor_eos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot the EOS computed with the deltafactor setup.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib :class:`Axes` or None if a new figure should be created.</span>
<span class="sd">            </span>
<span class="sd">        ================  ==============================================================</span>
<span class="sd">        kwargs            Meaning</span>
<span class="sd">        ================  ==============================================================</span>
<span class="sd">        cmap              Color map. default `jet`</span>
<span class="sd">        ================  ==============================================================</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">trial</span> <span class="o">=</span> <span class="s">&quot;deltafactor&quot;</span>
        <span class="n">ecuts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">num_ecuts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecuts</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;cmap&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&quot;jet&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ecut</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ecuts</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">][</span><span class="n">ecut</span><span class="p">]</span>
            <span class="n">num_sites</span><span class="p">,</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">etotals</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;num_sites&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;volumes&quot;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;etotals&quot;</span><span class="p">])</span>

            <span class="c"># Use same fit as the one employed for the deltafactor.</span>
            <span class="n">eos_fit</span> <span class="o">=</span> <span class="n">EOS</span><span class="o">.</span><span class="n">DeltaFactor</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">volumes</span><span class="o">/</span><span class="n">num_sites</span><span class="p">,</span> <span class="n">etotals</span><span class="o">/</span><span class="n">num_sites</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;ecut </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ecut</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;ecut </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ecut</span> 
            <span class="n">eos_fit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_ecuts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
<div class="viewcode-block" id="DojoReport.get_ecut_dfactprime"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.get_ecut_dfactprime">[docs]</a>    <span class="k">def</span> <span class="nf">get_ecut_dfactprime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;deltafactor&quot;</span><span class="p">]</span>
        <span class="n">ecuts</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&quot;dfactprime_meV&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ecuts</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ecuts</span><span class="p">),</span> <span class="n">values</span>
</div>
<div class="viewcode-block" id="DojoReport.compute_hints"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.compute_hints">[docs]</a>    <span class="k">def</span> <span class="nf">compute_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ecuts</span><span class="p">,</span> <span class="n">dfacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ecut_dfactprime</span><span class="p">()</span>
        <span class="n">abs_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">dfacts</span> <span class="o">-</span> <span class="n">dfacts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c">#print(list(zip(ecuts, dfacts)))</span>
        <span class="c">#print(abs_diffs)</span>

        <span class="n">hints</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ecut</span><span class="p">,</span> <span class="n">adiff</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ecuts</span><span class="p">,</span> <span class="n">abs_diffs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">adiff</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATOLS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">hints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">hints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecut</span>
        <span class="k">return</span> <span class="n">hints</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoReport.plot_deltafactor_convergence"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.plot_deltafactor_convergence">[docs]</a>    <span class="k">def</span> <span class="nf">plot_deltafactor_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s">&quot;WIEN2k&quot;</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot the convergence of the deltafactor parameters wrt ecut.</span>

<span class="sd">        Args:</span>
<span class="sd">            code: Reference code</span>
<span class="sd">            ax_list: List of matplotlib Axes, if ax_list is None a new figure is created</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">all</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;dfact_meV&quot;</span><span class="p">,</span> <span class="s">&quot;dfactprime_meV&quot;</span><span class="p">,</span> <span class="s">&quot;v0&quot;</span><span class="p">,</span> <span class="s">&quot;b0_GPa&quot;</span><span class="p">,</span> <span class="s">&quot;b1&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">what</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">all</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">what</span> <span class="o">=</span> <span class="n">list_strings</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">what</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">):</span>
                <span class="c"># Exclude keys</span>
                <span class="c">#print([type(w) for w in what])</span>
                <span class="n">what</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">what</span><span class="p">]</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">all</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">what</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">what</span>
            
        <span class="c"># get reference entry</span>
        <span class="kn">from</span> <span class="nn">pseudo_dojo.refdata.deltafactor</span> <span class="kn">import</span> <span class="n">df_database</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">df_database</span><span class="p">()</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&quot;deltafactor&quot;</span><span class="p">]</span>
        <span class="n">ecuts</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="k">if</span> <span class="n">ax_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=len(keys), ncols=1, sharex=True, squeeze=False)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;len(keys)=</span><span class="si">%s</span><span class="s"> != len(ax_list)=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ax_list</span><span class="p">,</span> <span class="n">keys</span><span class="p">)):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">ecut</span><span class="p">][</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">ecut</span> <span class="ow">in</span> <span class="n">ecuts</span><span class="p">])</span>
            <span class="c">#try:</span>
            <span class="n">refval</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="c">#except AttributeError:</span>
            <span class="c">#    refval = 0.0</span>

            <span class="c"># Plot difference pseudo - ref.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecuts</span><span class="p">,</span> <span class="n">values</span> <span class="o">-</span> <span class="n">refval</span><span class="p">,</span> <span class="s">&quot;bo-&quot;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$\Delta$&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Ecut [Ha]&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&quot;dfactprime_meV&quot;</span><span class="p">:</span>
                <span class="c"># Add horizontal lines (used to find hints for ecut).</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ecuts</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ecuts</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pad</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ATOLS</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;violet&quot;</span><span class="p">)):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">last</span> <span class="o">+</span> <span class="n">pad</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s">&#39;dotted&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">last</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s">&#39;dotted&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoReport.plot_gbrv_eos"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.plot_gbrv_eos">[docs]</a>    <span class="k">def</span> <span class="nf">plot_gbrv_eos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">struct_type</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses Matplotlib to plot the EOS computed with the GBRV setup</span>

<span class="sd">        Args:</span>
<span class="sd">            ax: matplotlib :class:`Axes` or None if a new figure should be created.</span>

<span class="sd">        ================  ==============================================================</span>
<span class="sd">        kwargs            Meaning</span>
<span class="sd">        ================  ==============================================================</span>
<span class="sd">        cmap              Color map. default `jet`</span>
<span class="sd">        ================  ==============================================================</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure or None if the GBRV test is not present</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">plt</span> <span class="o">=</span> <span class="n">get_ax_fig_plt</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">trial</span> <span class="o">=</span> <span class="s">&quot;gbrv_&quot;</span> <span class="o">+</span> <span class="n">struct_type</span>
        <span class="c"># Handle missing entries: noble gases, Hg ...</span>
        <span class="k">if</span> <span class="n">trial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">ecuts</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">num_ecuts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecuts</span><span class="p">)</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;cmap&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&quot;jet&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ecut</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ecuts</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">][</span><span class="n">ecut</span><span class="p">]</span>
            <span class="n">volumes</span><span class="p">,</span> <span class="n">etotals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;volumes&quot;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;etotals&quot;</span><span class="p">])</span>

            <span class="n">eos_fit</span> <span class="o">=</span> <span class="n">EOS</span><span class="o">.</span><span class="n">Quadratic</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">volumes</span><span class="p">,</span> <span class="n">etotals</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;ecut </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ecut</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;ecut </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ecut</span> 
            <span class="n">eos_fit</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_ecuts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>
</div>
    <span class="nd">@add_fig_kwargs</span>
<div class="viewcode-block" id="DojoReport.plot_gbrv_convergence"><a class="viewcode-back" href="../../../../pymatgen.io.abinitio.html#pymatgen.io.abinitio.pseudos.DojoReport.plot_gbrv_convergence">[docs]</a>    <span class="k">def</span> <span class="nf">plot_gbrv_convergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses Matplotlib to plot the convergence of the GBRV parameters wrt ecut.</span>

<span class="sd">        Args:</span>
<span class="sd">            ax_list: List of matplotlib Axes, if ax_list is None a new figure is created</span>

<span class="sd">        ================  ==============================================================</span>
<span class="sd">        kwargs            Meaning</span>
<span class="sd">        ================  ==============================================================</span>
<span class="sd">        ================  ==============================================================</span>

<span class="sd">        Returns:</span>
<span class="sd">            `matplotlib` figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
        <span class="n">stypes</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;fcc&quot;</span><span class="p">,</span> <span class="s">&quot;bcc&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax_list</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax_list</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stypes</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">ax_list</span> <span class="o">=</span> <span class="n">ax_list</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="c">#ax_list, fig, plt = get_axarray_fig_plt(ax_list, nrows=len(stypes), ncols=1, sharex=True, squeeze=False)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stypes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span> 
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;len(stypes)=</span><span class="si">%s</span><span class="s"> != len(ax_list)=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stypes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stype</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ax_list</span><span class="p">,</span> <span class="n">stypes</span><span class="p">)):</span>
            <span class="n">trial</span> <span class="o">=</span> <span class="s">&quot;gbrv_&quot;</span> <span class="o">+</span> <span class="n">stype</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span>
            <span class="n">ecuts</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">ecut</span><span class="p">][</span><span class="s">&quot;a0_rel_err&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">ecut</span> <span class="ow">in</span> <span class="n">ecuts</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$\Delta$&quot;</span> <span class="o">+</span> <span class="n">trial</span> <span class="o">+</span> <span class="s">&quot;a0_rel_err&quot;</span><span class="p">)</span>

            <span class="c"># Plot difference pseudo - ref.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecuts</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s">&quot;bo-&quot;</span><span class="p">)</span>
            <span class="c">#ax.hlines(y=0.0, xmin=min(ecuts), xmax=max(ecuts), color=&quot;red&quot;)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;Ecut [Ha]&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 3.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2011, Shyue Ping Ong, Anubhav Jain, Geoffroy Hautier, William Davidson Richard, Stephen Dacek, Sai Jayaraman, Michael Kocher, Dan Gunter, Shreyas Cholia, Vincent L Chevrier, Rickard Armiento.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>